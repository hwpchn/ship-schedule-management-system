# 模块文档总览

## 📋 概述

船舶航线管理系统采用模块化设计，将功能按业务领域划分为独立的Django应用模块。每个模块都有明确的职责和边界，便于维护和扩展。

## 🏗️ 系统架构

### 核心模块
```
ship_schedule_project/
├── ship_schedule/          # 项目主配置模块
├── authentication/        # 用户认证和权限管理模块
├── schedules/             # 船期管理核心模块
└── local_fees/            # 本地费用管理模块
```

### 模块依赖关系
```
┌─────────────────┐
│  ship_schedule  │  ← 项目配置中心
│   (主配置)      │
└─────────────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌──▼──────────┐
│ auth  │ │  schedules  │
│ 认证  │ │   船期管理   │
└───────┘ └─────────────┘
    │           │
    │      ┌────▼────┐
    └─────▶│local_fees│
           │ 本地费用 │
           └─────────┘
```

## 🔧 模块详情

### 1. 项目主配置模块 (ship_schedule)
**路径**: `ship_schedule/`  
**职责**: Django项目的核心配置和URL路由

#### 主要文件
- `settings.py` - 项目配置
- `urls.py` - 主URL路由配置
- `wsgi.py` - WSGI应用入口
- `asgi.py` - ASGI应用入口

#### 核心功能
- 数据库配置
- 中间件配置
- 静态文件配置
- API路由分发
- 跨域设置

### 2. 认证模块 (authentication) 🔐
**路径**: `authentication/`  
**职责**: 用户认证、权限管理和用户信息管理

#### 核心功能
- JWT Token认证
- 用户注册和登录
- 基于角色的权限控制
- 用户信息管理
- 权限和角色管理

#### 主要模型
- `User` - 用户模型
- `Permission` - 权限模型
- `Role` - 角色模型

**详细文档**: [认证模块文档](authentication.md)

### 3. 船期管理模块 (schedules) 🚢
**路径**: `schedules/`  
**职责**: 船舶航线管理、船舶额外信息管理和共舱分组

#### 核心功能
- 船舶航线CRUD操作
- 船舶额外信息管理
- 共舱分组查询
- 前台船期查询API
- 数据版本控制
- 批量操作支持

#### 主要模型
- `VesselSchedule` - 船舶航线模型
- `VesselInfoFromCompany` - 船舶额外信息模型

**详细文档**: [船期管理模块文档](schedules.md)

### 4. 本地费用模块 (local_fees) 💰
**路径**: `local_fees/`  
**职责**: 本地费用信息管理

#### 核心功能
- 本地费用CRUD操作
- 多种计费方式支持
- 前台费用查询API
- 多货币支持

#### 主要模型
- `LocalFee` - 本地费用模型

**详细文档**: [本地费用模块文档](local_fees.md)

## 🔄 模块间交互

### 数据流向
```
用户请求 → 认证模块(验证) → 业务模块(处理) → 数据库 → 响应
```

### 权限控制流程
```
API请求 → JWT验证 → 权限检查 → 业务逻辑 → 数据操作
```

### 模块通信方式
1. **直接导入**: 模块间通过Python导入机制共享代码
2. **数据库关联**: 通过外键和关联字段建立数据关系
3. **信号机制**: 使用Django信号进行模块间通信
4. **共享工具**: 通过公共工具函数和类库

## 📊 数据模型关系

### 核心实体关系
```
User (用户)
  ├── UserRole (用户角色关联)
  └── Permission (权限)

VesselSchedule (船舶航线)
  └── VesselInfoFromCompany (船舶额外信息)
      └── 关联字段: polCd, podCd, vessel, voyage, carriercd

LocalFee (本地费用)
  └── 独立实体，通过polCd, podCd关联航线
```

### 数据同步机制
- **自动同步**: VesselSchedule创建时自动创建对应的VesselInfoFromCompany记录
- **版本控制**: 通过data_version字段管理数据版本
- **软删除**: 通过status字段实现软删除机制

## 🛡️ 安全设计

### 认证安全
- JWT Token机制
- Token自动过期和刷新
- 密码加密存储
- 登录失败限制

### 权限安全
- 基于角色的访问控制(RBAC)
- 细粒度权限分配
- API级别权限验证
- 数据级别权限控制

### 数据安全
- SQL注入防护
- XSS攻击防护
- CSRF保护
- 输入数据验证

## 🔧 配置管理

### 环境配置
- 开发环境配置
- 测试环境配置
- 生产环境配置
- 环境变量管理

### 数据库配置
- 多数据库支持
- 连接池配置
- 读写分离支持
- 数据库迁移管理

## 📈 性能优化

### 查询优化
- 数据库索引优化
- 查询语句优化
- 分页查询支持
- 缓存机制

### API优化
- 响应数据压缩
- 批量操作支持
- 异步处理支持
- 限流机制

## 🧪 测试策略

### 测试类型
- 单元测试
- 集成测试
- API测试
- 性能测试

### 测试覆盖
- 模型测试
- 视图测试
- 权限测试
- 业务逻辑测试

## 📝 开发规范

### 代码规范
- PEP 8 Python代码规范
- Django最佳实践
- 代码注释规范
- 变量命名规范

### 文档规范
- API文档标准
- 代码文档标准
- 数据库文档标准
- 部署文档标准

## 🔗 相关链接

- **[认证模块详细文档](authentication.md)**
- **[船期管理模块详细文档](schedules.md)**
- **[本地费用模块详细文档](local_fees.md)**
- **[API文档总览](../api/README.md)**
- **[开发指南](../development/README.md)**
